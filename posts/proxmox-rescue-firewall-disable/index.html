<!doctype html><html class=dark lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>Where's /etc/pve/firewall/cluster.fw in rescue images?</title><meta content="Where's /etc/pve/firewall/cluster.fw in rescue images?" property=og:title><meta content="Ah, so you've locked yourself out of your own Proxmox server. Don't worry, happens." property=og:description><meta content="Ah, so you've locked yourself out of your own Proxmox server. Don't worry, happens." name=description><link href=https://svnscha.de/posts/proxmox-rescue-firewall-disable/ rel=canonical><link href=/favicon.ico rel=icon type=image/png><link href=/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/site.webmanifest rel=manifest><link href=https://svnscha.de/fonts.css rel=stylesheet><script>var _paq=window._paq=window._paq||[];_paq.push(['disableCookies']);_paq.push(['trackPageView']);_paq.push(['enableLinkTracking']);_paq.push(['enableHeartBeatTimer']);(function(){var a="//analytics.liasoft.de/";_paq.push(['setTrackerUrl',a+ 'matomo.php']);_paq.push(['setSiteId','27']);var b=document,c=b.createElement('script'),d=b.getElementsByTagName('script')[0];c.async=true;c.src=a+ 'matomo.js';d.parentNode.insertBefore(c,d)})()</script><link href=https://svnscha.de/atom.xml rel=alternate title=svnscha type=application/atom+xml><link href=https://svnscha.de/theme/dark.css rel=stylesheet><link href=https://svnscha.de/main.css media=screen rel=stylesheet><link href=https://svnscha.de/lightbox.css rel=stylesheet><body><div class=content><header><style>.avatar{vertical-align:middle;width:150px;height:150px;border-radius:50%}#wrapper{width:100%;clear:both;text-align:center}</style><div class=main><a href=https://svnscha.de title=svnscha>svnscha</a><div class=socials><a class=social href=https://www.linkedin.com/in/svnscha/ rel=me> <img alt=linkedin src=/social_icons/linkedin.svg> </a><a class=social href=https://github.com/svnscha/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=/about style=margin-left:.7em>/about</a><a href=/notes style=margin-left:.7em>/notes</a></nav><div id=wrapper><a href=https://svnscha.de title=svnscha> <img alt="svnscha - Profile Picture" class=avatar src=/svnscha.webp> </a></div></header><main><article><div class=title><h1 class=page-header>Where's /etc/pve/firewall/cluster.fw in rescue images?</h1><div class=meta>Posted on <time>2024-10-04</time></div></div><section class=body><h2 id=why-you-ask>Why, You Ask?</h2><p>So, you've gone and locked yourself out of your Proxmox server, huh? Don't worry, happens. Now you're probably scrambling for a way back in before you fully comprehend that your own firewall rules have turned against you. But hey, no worries! Let's break down this rescue operation step by step.<h2 id=step-1-mount-the-proxmox-system>Step 1: Mount the Proxmox System</h2><p>First, you need to access your Proxmox filesystem. If you're using LVM (Logical Volume Management), this step is pretty straightforward:<pre class=language-bash data-lang=bash style=background:#282c34;color:#abb2bf><code class=language-bash data-lang=bash><span style=color:#e06c75>mount</span><span> /dev/mapper/vg0-root /mnt
</span></code></pre><p>With your filesystem mounted, chroot into it:<pre class=language-bash data-lang=bash style=background:#282c34;color:#abb2bf><code class=language-bash data-lang=bash><span style=color:#e06c75>chroot</span><span> /mnt/
</span></code></pre><p>Now you're inside your system, ready to work some magic.<h2 id=step-2-disabling-the-firewall>Step 2: Disabling the Firewall</h2><p>The firewall is likely what caused you to get locked out, so we'll need to disable it temporarily. Run the following commands:<pre class=language-bash data-lang=bash style=background:#282c34;color:#abb2bf><code class=language-bash data-lang=bash><span style=color:#e06c75>systemctl</span><span> disable pve-firewall
</span><span style=color:#e06c75>systemctl</span><span> mask pve-firewall
</span></code></pre><p>Once you've done that, reboot the server. You should now be able to reconnect to your system normally, without the firewall cutting you off.<h2 id=step-3-fix-the-issue-and-restore-the-firewall>Step 3: Fix the Issue and Restore the Firewall</h2><p>After fixing whatever issue got you locked out, it's time to re-enable the firewall. Run these commands to restore it:<pre class=language-bash data-lang=bash style=background:#282c34;color:#abb2bf><code class=language-bash data-lang=bash><span style=color:#e06c75>systemctl</span><span> unmask pve-firewall
</span><span style=color:#e06c75>systemctl</span><span> enable pve-firewall
</span><span style=color:#e06c75>systemctl</span><span> start pve-firewall
</span></code></pre><p>Your firewall should now be back up and running, but without the lockout problem.<h2 id=a-note-about-etc-pve-firewall-cluster-fw>A Note About <code>/etc/pve/firewall/cluster.fw</code></h2><p>If you're hunting for <code>/etc/pve/firewall/cluster.fw</code> while in rescue mode, hoping it's a typical file you can modify directly, you're out of luck. This file is part of Proxmox's cluster-wide configuration and is not stored as a regular file on the disk. Instead, it's managed through Proxmox's internal database, which is part of the <a href=https://pve.proxmox.com/wiki/Proxmox_Cluster_File_System_(pmxcfs)>Proxmox Cluster File System (pmxcfs)</a>. As such, it doesn't exist as a standalone file you can access from rescue mode. To modify this configuration, you'll need to regain full access to Proxmox and make changes from within the Proxmox interface or by editing it via the proper tools once you're back online.<h2 id=wrapping-up>Wrapping Up</h2><p>And there you have it! With your system back up and running, and the firewall behaving, you can get back to managing your Proxmox server. Just be cautious next time you tweak the firewall rules — locking yourself out isn't the most fun way to spend your day!</section></article></main><hr><center><small>Copyright © 2025 Sven Scharmentke. All rights reserved.</small></center></div><script src=https://svnscha.de/lightbox.js></script>